/*! kist-fauxAnchor 0.4.13 - Simulate default anchor action. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b,c){function d(a,b,c){"anchor"!==c&&a.parents("."+i.classes.item).length&&!b.isPropagationStopped()&&b.stopPropagation()}function e(a,b,c){var d=n.browser.webkit.all,e=n.browser.safari.all,f=n.browser.ie.lte8,g=n.browser.ie.mobileWP,h=n.feature.touch,i=this.options.type,j=n.input.metaKey(c),k=0;return"click"===a&&((!d&&!h||f&&h)&&k++,g&&k--),"mousedown"===a&&((d||g||h&&2!==b)&&k++,f&&h&&k--),"keydown"===a&&(k++,d||13!==b||k--,"anchor"===i&&(!d&&h&&13===b&&k++,f&&h&&13===b&&k--),"button"===i&&((!d&&h&&13===b||e&&j)&&k++,(d&&13===b&&j||f&&h&&13===b)&&k--),"unfocusable"===i&&d&&13===b&&k--),(this.prevented||o.contextMenu.call(this,i,c))&&k++,Boolean(Math.max(0,k))}function f(a){var b=a.which,c=a.type,f=this.options.type;"anchor"===f&&"click"===c&&a.preventDefault(),e.call(this,c,b,a)||(this.simulateAlternative=o.simulateAlternative.call(this,f,a),d(this.dom.el,a,f),this.action(o.href.call(this,f),o.target.call(this,f,a),a))}function g(b){var c={};return"object"==typeof b&&(b.primary&&(c.basic=b.primary),b.secondary&&(c.alternative=b.secondary),c=a.extend({},b,c)),c}function h(b,c){this.element=b,this.options=a.extend({},this.defaults,{type:o.type(this.element)},c),l.setup.call(this),j.setup.call(this),k.setup.call(this),m.shouldSetup.call(this)&&(m.instance.setup.call(this),m.dom.setup.call(this),m.events.setup.call(this))}var i={name:"fauxAnchor",ns:{css:"kist-FauxAnchor",event:".kist.fauxAnchor"},error:function(a){throw new Error(i.name+": "+a)}};i.classes={item:i.ns.css+"-item",contextMenu:i.ns.css+"-contextMenu",contextMenuItem:i.ns.css+"-contextMenu-item"},i.publicMethods=["destroy","prevent","unprevent"],i.instancesCount=0;var j={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this.dom.el.addClass(i.classes.item),"unfocusable"===this.options.type&&this.options.focus&&this.dom.el.attr({tabindex:0,role:"link"}),m.passesTest.call(this)&&this.dom.el.attr({contextmenu:i.classes.contextMenu})},destroy:function(){this.dom.el.removeClass(i.classes.item),"unfocusable"===this.options.type&&this.options.focus&&this.dom.el.removeAttr("tabindex role"),m.passesTest.call(this)&&this.dom.el.removeAttr("contextmenu")}},k={setup:function(){this.dom.el.on("click"+this.instance.ens,a.proxy(f,this)),this.dom.el.on("mousedown"+this.instance.ens,a.proxy(f,this)),this.dom.el.on("keydown"+this.instance.ens,a.proxy(f,this)),m.passesTest.call(this)&&this.dom.el.on("contextmenu"+this.instance.ens,a.proxy(function(a){d(this.dom.el,a,this.options.type),this.shouldActivateAction(o.href.call(this,this.options.type),a)?(this.dom.el.attr("contextmenu")||this.dom.el.attr("contextmenu",i.classes.contextMenu),m.common.instance=this,m.common.event=a):this.dom.el.removeAttr("contextmenu")},this))},destroy:function(){this.dom.el.off(this.instance.ens)}},l={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=l.id++,this.instance.ens=i.ns.event+"."+this.instance.id,i.instancesCount++},destroy:function(){delete a.data(this.element)[i.name],i.instancesCount--}},m={common:{dom:a(),event:null,instance:null},setup:!1,passesTest:function(){return this.options.contextMenu&&"anchor"!==this.options.type&&n.feature.contextMenu},shouldSetup:function(){return m.passesTest.call(this)&&!m.setup},shouldDestroy:function(){return!i.instancesCount&&m.setup},instance:{setup:function(){m.setup=!0},destroy:function(){m.setup=!1,m.common.instance=null}},dom:{setup:function(){var b=i.classes.contextMenuItem,c=[{label:"Open Link in New Tab","class":b+" "+b+"--newTab"},{label:"Open Link in New Window","class":b+" "+b+"--newWindow"}];m.common.dom=a("<menu />",{type:"context",id:i.classes.contextMenu}).appendTo("body"),a.each(c,function(b,c){m.common.dom.append(a("<menuitem />",c))})},destroy:function(){m.common.dom.remove(),m.common.dom=a()}},events:{setup:function(){m.common.dom.on("click"+i.ns.event,"."+i.classes.contextMenuItem,function(){var a=m.common.instance,b=m.common.event;a.simulateAlternative=!0,a.action(o.href.call(a,a.options.type),"_blank",b)})},destroy:function(){m.common.dom.off(i.ns.event),m.common.event=null}}},n={platform:{osx:/OS X/i.test(navigator.userAgent)},browser:{webkit:{all:"WebkitAppearance"in c.documentElement.style},safari:{all:/constructor/i.test(b.HTMLElement)},ff:{all:"MozAppearance"in c.documentElement.style},ie:{lte8:c.all&&!c.addEventListener,mobileWP:/IEMobile/i.test(navigator.userAgent)}},feature:{touch:"Modernizr"in b&&Modernizr.touchevents||"ontouchstart"in b||"DocumentTouch"in b&&c instanceof DocumentTouch,contextMenu:"Modernizr"in b&&Modernizr.contextmenu||"contextMenu"in c.documentElement&&"HTMLMenuItemElement"in b},input:{metaKey:function(a){return a.ctrlKey&&!n.platform.osx||a.metaKey}}},o={type:function(b){return b=a(b),b.is("a")?"anchor":b.is("button")||b.is('input[type="button"]')?"button":"unfocusable"},target:function(a,b){return 2===b.which||(1===b.which||13===b.which&&"anchor"!==a||13===b.which&&"anchor"===a&&!n.browser.webkit.all)&&n.input.metaKey(b)?"_blank":this.dom.el["anchor"===a?"attr":"data"]("target")||""},href:function(a){return this.dom.el["anchor"===a?"attr":"data"]("href")||""},contextMenu:function(a,b){return 3===b.which||(1===b.which||13===b.which)&&b.ctrlKey&&n.platform.osx?!0:!1},simulateAlternative:function(a,b){return"anchor"===a&&(2===b.which&&!n.browser.webkit.all&&!n.browser.ie.lte8||this.dom.el.is(b.target)&&n.browser.ie.lte8&&(2===b.which||1===b.which&&b.ctrlKey))?!1:!0}};a.extend(h.prototype,{action:function(b,c,d){var e="_blank"===c?"alternative":"basic";if(this.shouldActivateAction(b,d))return this.options[e].call(this.element,d,a.proxy(this[e],this,b))},shouldActivateAction:function(b,c){return"anchor"!==this.options.type&&a(c.target).closest("a").length||!this.options.condition.call(this.element,c)||!b?!1:!0},basic:function(a){b.location.assign(a)},alternative:function(a){this.simulateAlternative&&b.open(a,"_blank")},destroy:function(){j.destroy.call(this),k.destroy.call(this),l.destroy.call(this),m.shouldDestroy.call(this)&&(m.dom.destroy.call(this),m.events.destroy.call(this),m.instance.destroy.call(this))},prevent:function(){this.prevented=!0},unprevent:function(){this.prevented=!1},prevented:!1,defaults:{contextMenu:!0,focus:!0,basic:function(a,b){b()},alternative:function(a,b){b()},condition:function(){return!0}}}),a.kist=a.kist||{},a.fn[i.name]=function(b){return"string"==typeof b&&-1!==a.inArray(b,i.publicMethods)?this.each(function(){var c=a.data(this,i.name);c&&c[b]()}):(b=g(b),this.each(function(){a.data(this,i.name)||a.data(this,i.name,new h(this,b))}))}}(jQuery,window,document);