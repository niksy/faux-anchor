/*! kist-fauxAnchor 0.4.12 - Simulate default anchor action. | Author: Ivan NikoliÄ‡, 2014 | License: MIT */
!function(a,b,c){function d(a,b,c){var d=m.browser.webkit.all,e=m.browser.safari.all,f=m.browser.ie.lte8,g=m.browser.ie.mobileWP,h=m.feature.touch,i=this.options.type,j=m.input.metaKey(c),k=0;return"click"===a&&((!d&&!h||f&&h)&&k++,g&&k--),"mousedown"===a&&((d||g||h&&2!==b)&&k++,f&&h&&k--),"keydown"===a&&(k++,d||13!==b||k--,"anchor"===i&&(!d&&h&&13===b&&k++,f&&h&&13===b&&k--),"button"===i&&((!d&&h&&13===b||e&&j)&&k++,(d&&13===b&&j||f&&h&&13===b)&&k--),"unfocusable"===i&&d&&13===b&&k--),(this.prevented||n.contextMenu.call(this,i,c))&&k++,Boolean(Math.max(0,k))}function e(a){var b=a.which,c=a.type,e=this.options.type;"anchor"===e&&"click"===c&&a.preventDefault(),d.call(this,c,b,a)||(this.simulateAlternative=n.simulateAlternative.call(this,e,a),this.action(n.href.call(this,e),n.target.call(this,e,a),a))}function f(b){var c={};return"object"==typeof b&&(b.primary&&(c.basic=b.primary),b.secondary&&(c.alternative=b.secondary),c=a.extend({},b,c)),c}function g(b,c){this.element=b,this.options=a.extend({},this.defaults,{type:n.type(this.element)},c),k.setup.call(this),i.setup.call(this),j.setup.call(this),l.shouldSetup.call(this)&&(l.instance.setup.call(this),l.dom.setup.call(this),l.events.setup.call(this))}var h={name:"fauxAnchor",ns:{css:"kist-FauxAnchor",event:".kist.fauxAnchor"},error:function(a){throw new Error(h.name+": "+a)}};h.classes={item:h.ns.css+"-item",contextMenu:h.ns.css+"-contextMenu",contextMenuItem:h.ns.css+"-contextMenu-item"},h.publicMethods=["destroy","prevent","unprevent"],h.instancesCount=0;var i={setup:function(){this.dom=this.dom||{},this.dom.el=a(this.element),this.dom.el.addClass(h.classes.item),"unfocusable"===this.options.type&&this.options.focus&&this.dom.el.attr({tabindex:0,role:"link"}),l.passesTest.call(this)&&this.dom.el.attr({contextmenu:h.classes.contextMenu})},destroy:function(){this.dom.el.removeClass(h.classes.item),"unfocusable"===this.options.type&&this.options.focus&&this.dom.el.removeAttr("tabindex role"),l.passesTest.call(this)&&this.dom.el.removeAttr("contextmenu")}},j={setup:function(){this.dom.el.on("click"+this.instance.ens,a.proxy(e,this)),this.dom.el.on("mousedown"+this.instance.ens,a.proxy(e,this)),this.dom.el.on("keydown"+this.instance.ens,a.proxy(e,this)),l.passesTest.call(this)&&this.dom.el.on("contextmenu"+this.instance.ens,a.proxy(function(a){this.shouldActivateAction(n.href.call(this,this.options.type),a)?(this.dom.el.attr("contextmenu")||this.dom.el.attr("contextmenu",h.classes.contextMenu),l.common.instance=this,l.common.event=a):this.dom.el.removeAttr("contextmenu")},this))},destroy:function(){this.dom.el.off(this.instance.ens)}},k={id:0,setup:function(){this.instance=this.instance||{},this.instance.id=k.id++,this.instance.ens=h.ns.event+"."+this.instance.id,h.instancesCount++},destroy:function(){delete a.data(this.element)[h.name],h.instancesCount--}},l={common:{dom:a(),event:null,instance:null},setup:!1,passesTest:function(){return this.options.contextMenu&&"anchor"!==this.options.type&&m.feature.contextMenu},shouldSetup:function(){return l.passesTest.call(this)&&!l.setup},shouldDestroy:function(){return!h.instancesCount&&l.setup},instance:{setup:function(){l.setup=!0},destroy:function(){l.setup=!1,l.common.instance=null}},dom:{setup:function(){var b=h.classes.contextMenuItem,c=[{label:"Open Link in New Tab","class":b+" "+b+"--newTab"},{label:"Open Link in New Window","class":b+" "+b+"--newWindow"}];l.common.dom=a("<menu />",{type:"context",id:h.classes.contextMenu}).appendTo("body"),a.each(c,function(b,c){l.common.dom.append(a("<menuitem />",c))})},destroy:function(){l.common.dom.remove(),l.common.dom=a()}},events:{setup:function(){l.common.dom.on("click"+h.ns.event,"."+h.classes.contextMenuItem,function(){var a=l.common.instance,b=l.common.event;a.simulateAlternative=!0,a.action(n.href.call(a,a.options.type),"_blank",b)})},destroy:function(){l.common.dom.off(h.ns.event),l.common.event=null}}},m={platform:{osx:/OS X/i.test(navigator.userAgent)},browser:{webkit:{all:"WebkitAppearance"in c.documentElement.style},safari:{all:/constructor/i.test(b.HTMLElement)},ff:{all:"MozAppearance"in c.documentElement.style},ie:{lte8:c.all&&!c.addEventListener,mobileWP:/IEMobile/i.test(navigator.userAgent)}},feature:{touch:"Modernizr"in b&&Modernizr.touchevents||"ontouchstart"in b||"DocumentTouch"in b&&c instanceof DocumentTouch,contextMenu:"Modernizr"in b&&Modernizr.contextmenu||"contextMenu"in c.documentElement&&"HTMLMenuItemElement"in b},input:{metaKey:function(a){return a.ctrlKey&&!m.platform.osx||a.metaKey}}},n={type:function(b){return b=a(b),b.is("a")?"anchor":b.is("button")||b.is('input[type="button"]')?"button":"unfocusable"},target:function(a,b){return 2===b.which||(1===b.which||13===b.which&&"anchor"!==a||13===b.which&&"anchor"===a&&!m.browser.webkit.all)&&m.input.metaKey(b)?"_blank":this.dom.el["anchor"===a?"attr":"data"]("target")||""},href:function(a){return this.dom.el["anchor"===a?"attr":"data"]("href")||""},contextMenu:function(a,b){return 3===b.which||(1===b.which||13===b.which)&&b.ctrlKey&&m.platform.osx?!0:!1},simulateAlternative:function(a,b){return"anchor"===a&&(2===b.which&&!m.browser.webkit.all&&!m.browser.ie.lte8||this.dom.el.is(b.target)&&m.browser.ie.lte8&&(2===b.which||1===b.which&&b.ctrlKey))?!1:!0}};a.extend(g.prototype,{action:function(b,c,d){var e="_blank"===c?"alternative":"basic";if(this.shouldActivateAction(b,d))return this.options[e].call(this.element,d,a.proxy(this[e],this,b))},shouldActivateAction:function(b,c){return"anchor"!==this.options.type&&a(c.target).closest("a").length||!this.options.condition.call(this.element,c)||!b?!1:!0},basic:function(a){b.location.assign(a)},alternative:function(a){this.simulateAlternative&&b.open(a,"_blank")},destroy:function(){i.destroy.call(this),j.destroy.call(this),k.destroy.call(this),l.shouldDestroy.call(this)&&(l.dom.destroy.call(this),l.events.destroy.call(this),l.instance.destroy.call(this))},prevent:function(){this.prevented=!0},unprevent:function(){this.prevented=!1},prevented:!1,defaults:{contextMenu:!0,focus:!0,basic:function(a,b){b()},alternative:function(a,b){b()},condition:function(){return!0}}}),a.kist=a.kist||{},a.fn[h.name]=function(b){return"string"==typeof b&&-1!==a.inArray(b,h.publicMethods)?this.each(function(){var c=a.data(this,h.name);c&&c[b]()}):(b=f(b),this.each(function(){a.data(this,h.name)||a.data(this,h.name,new g(this,b))}))}}(jQuery,window,document);